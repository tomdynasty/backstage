openapi: "3.0.2"

info:
  title: Order Manage
  description: "訂單 API，路徑需為: /order_api"
  version: "0.1.0"
servers:
- url: "http://localhost/order_api"
  description: local

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
    UserTokenAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  responses:
    UnauthorizedError:
      description: API key is missing or invalid
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
          examples:
            API-Key-Error:
              value:
                message: "API key is missing or invalid"
            Token-Error:
              value:
                message: "Authorization token is missing or invalid"
    BadRequestError:
      description: Bad request
      content:
        application/json:
          schema:
            oneOf:
              - type: object
                properties:
                  message:
                    type: string
                    example: "error bad request"

              - type: object
                properties:
                  message:
                    type: string
                    example: "error bad request"
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        domain:
                          type: string
                          example: "abc.com"
                        result:
                          type: string
                          example: "can not use"
  parameters:
    PageParam:
      in: query
      name: page
      schema:
        type: integer
      example: 1
    PerPageParam:
      in: query
      name: per_page
      schema:
        type: integer
      example: 20

paths:
  /orders/{year}/record:
    get:
      tags:
        - 訂單記錄
      summary: 指定年份的訂單記錄清單
      description: 指定年份的訂單記錄清單
      parameters:
        - name: year
          required: true
          in: path
          schema:
            type: integer
            example: 2022
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    name:
                      type: string                      
                    sex:
                      type: string
                    order_items:
                      type: array
                      items:
                        type: string
                    order_date:
                      type: string
                      format: date
                    payment_status:
                      type: integer
                    note:
                      type: string                      
              example:
                  - id: 1
                    name: "王力紅"
                    sex: "male"
                    order_items: ["體重計"]
                    order_date: "2022/01/05 10:00:00"
                    payment_status: 1
                    note: ""
                  - id: 2
                    name: "周截倫"
                    sex: "male"
                    order_items: ["智慧手錶", "體重計"]
                    order_date: "2022/01/05 10:00:00"
                    payment_status: 1
                    note: ""
                  - id: 3
                    name: "賽琳娜紅"
                    sex: "femail"
                    order_items: ["雕塑營課程", "智慧手錶"]
                    order_date: "2022/01/05 10:00:00"
                    payment_status: 1
                    note: ""
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "500":
           description: Internal error

  /orders/{order_id}/note:
    patch:
      tags:
        - 訂單備註
      summary: 修改訂單備註
      security:
        - ApiKeyAuth: []
        - UserTokenAuth: []
      parameters:
        - name: order_id
          required: true
          in: path
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                note:
                  type: string
                  example: "修改備註內容"
      responses:
        "204":
          description: No Content
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "403":
          description: Permission denied
        "500":
          description: Internal error
